<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="referrer" content="same-origin">
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Baloo+Da+2&family=Baloo+Paaji+2:wght@400;600&display=swap"
		rel="stylesheet">
	<link rel="stylesheet" href="/css/style.css" />
	<title>Ingredient selection</title>
</head>

<body>

	<div class="intro">
		<h1 class="header">ChickenTinder</h1>
		<h2>Final Dish: FINAL_DISH</h2>
		<h2>Date: FINAL_DATETIME</h2>
		<img class="food-image" src="IMAGE_SOURCE">
		<!-- TODO: scale image to fit in a bounding box -->
	</div>

	<div class="side-panel ingredient-panel">
		<div class="description">
			RECIPE_DESCRIPTION
		</div>

		<div class="ingredient-selection-wrapper">
			<!-- TODO: populate automatically -->
			<input type="checkbox" id="checkbox_1">
			<label for="checkbox_1">soup base</label>
			<span data-id="1"></span>
			<input type="checkbox" id="checkbox_2">
			<label for="checkbox_2">sliced beef</label>
			<span data-id="2"></span>
			<input type="checkbox" id="checkbox_3">
			<label for="checkbox_3">napa cabbage</label>
			<span data-id="3"></span>
			<input type="checkbox" id="checkbox_4">
			<label for="checkbox_4">enoki/shiitake</label>
			<span data-id="4"></span>
		</div>
	</div>

	<script src="/js/twgl.min.js"></script>
	<script src="/js/shaders.js"></script>
	<script src="/js/blob.js"></script>
	<script src="/socket.io/socket.io.js"></script>
	<script>
		const groupId = "GROUP_ID_REPLACED_BY_EXPRESS";
		const name = "NAME_REPLACED_BY_EXPRESS"; // TODO
		const SOCKET_URL = `/?groupID=${groupId}&name=${encodeURIComponent(name)}`;
		const socket = io(SOCKET_URL);

		const ingredientNameToCheckbox = new Map();

		for (const checkbox of document.querySelectorAll('.ingredient-selection-wrapper input')) {
			const ingredient = checkbox.nextElementSibling.innerText;
			ingredientNameToCheckbox.set(ingredient, checkbox);
			checkbox.addEventListener('change', (e) => {
				const id = checkbox.id;
				const isChecked = checkbox.checked;
				socket.emit('edit', {
					ingredient,
					content: isChecked ? name : '',
				});
			});
		}

		socket.on('edit', ({ ingredient, content }) => {
			const checkbox = ingredientNameToCheckbox.get(ingredient);
			checkbox.checked = content.length > 0;
			checkbox.nextElementSibling.nextElementSibling.innerText = content || "None";
		});
	</script>
</body>

</html>